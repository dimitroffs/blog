---
layout: post
title: "Да си направим дрон - еп. 5 - Контролери за мотори (ESC)"
author: "Димитър Димитров"
categories: play
tags: [play]
image: p10/escHeader.jpg
---

Уха! Месец и отгоре след [последната ми тема]({{ site.github.url }}/play/да-си-направим-дрон-4-мотори-и-перки.html) - ето ни отново! Здравейте и честита зима! С настъпването й, сякаш се омързеливих малко, но задълженията вкъщи и на работа ме държат буден. Но пък това си е най-хубавото време през годината - пълно с празници и надежди за нещо по-добро! Та така и за мен - надявам се през новата година да литне вече дрончето. Ще ви призная нещо - вече всичко необходимо пристигна, успях да го сглобя (без видео обслужване) и дори тествах моторите - с и без перки! Все още нямам официално излитане, но и това ще дойде! Доста съм развълнуван и не прибързвам с нещата, да не объркам нещо.

И така - в днешната тема щях да разказвам за видео обслужването, но ще го оставя за по-натам, когато премина през по-важните неща. Не че и то не е важно, но със сигурност може и без него да си летите. Ето защо смених подредбата в темите и ще ви разкажа за контролерите на моторите - Electronic Speed Controller (ESC). След [темата за мотори и перки]({{ site.github.url }}/play/да-си-направим-дрон-4-мотори-и-перки.html) мисля, че е логично да продължим с това - как аджеба ще задвижим тея мотори!? Ето как...

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p10/esc0.jpg "Контролер на мотор DYS XS30A BLHeli 30A")

### Какво е ESC?
ESC по своята същност е това, с което е озаглавен - електронен контролер за скорост. Той представлява интегрална схема, която се захранва с определен входящ ток и на която се подават определени входни сигнали, след което на изхода излиза определен изчислен ток, който задвижва безчетков мотор, закачен там. И защо, за Бога, толкова сложно е това задвижване!? Ето как... Четирикоптера има четири перки, които се въртят в определена посока. В зависимост от скоростта на въртене на перките (някои по-бързо, а други - по-бавно), се определя дали дронът ще се движи в определена посока. И познайте - ако скоростта не е подходяща - лошо. Не искаме нещо около 3 кг да ни падне на главите, нали!? Ето тук се намесват контролерите за скорост - те определят колко бързо да се върти един безчетков мотор. Няма да задълбавам с по-сложни обяснения, за любопитните от вас нета е пълен с [интересни теми за ESC](https://www.google.com/search?&q=electronic+speed+controller).

Признавам си - и на мен ми е нова тази хоби наука, затова сигурно и обясненията ми не са много подробни, но се старая да го обяснявам, така че да е лесно и забавно.

### Видове ESC
Темата за контролерите за мотори е наистина дебела, затова ще гледам да я държа стегната и разбираема. Видовете контролери са накратко казано - различни! [Една готина статия](https://www.genstattu.com/blog/what-the-type-of-esc/) много добре ми подсказа как да ви ги обясня (в случая - преведа от английски език). Нека ги разделим на три основни вида:
##### според вида на мотора, който управляват:
   * контролери за четкови мотори - дву-жична връзка с мотора. Управляват директно мотора като подават определено напрежение и ток, които развъртат ротора.
   * контролери за безчеткови мотори - три-жична връзка с мотора. Фино управление, чрез сигнали от контролера, до достигане на определените от него обороти. Поддържат избраните обороти на мотора и спират при определени зададени условия.

##### според софтуера (фърмуера), който ползват:
   * контролери с отворен фърмуер - гилдията от хоби-майстори обича безплатните неща и се грижи те да се развиват в правилната посока. Ето защо и най-популярните фърмуери са тези с отворен код. Най-познатите сред тях са BLHeli, SimonK и KISS. Имено, поради голямата им популярност, контролерите, които ги ползват са най-разпространените и най-достъпните в ценови план. Софтуера постоянно се осъвършенства и подобрява, което допълнително накланя везните в тяхна полза.
   * контролери със затворен фърмуер - скъпо, скъпо. Дори не съм се интересувал за тях...

##### BEC съвместимост
Първо малко думи за BEC (Battery Elimination Circuit) - това е технология, която позволява на контролера на мотора да отдава волтаж в порядъка на 5 волта и около 2-3 ампера (BEC) и 10 ампера (UBEC) ток. Ще попитате... че закакво ми е това напрежение от контролер на мотор? Еми помислете... що да не си "захраня" летателния контролер оттам? Или пък някое серво двигателче? Доста е удобно при различните хоби проекти и е било много разпространено в зората на контролерите на мотори. Сега тази функция се "изземва", според мен, от платката за разпределяне на напрежението (PDB - Power Distribution Board). Масата ESC-та на пазара са БЕЗ BEC функционалност, но това хич не ги прави неефективни, напротив - олекотява ги и ги концентрира към правилните настройки, за което са сложени - да управляват моторите, а не някакви периферии. Та според BEC-съвместимост се делят на:
   * с BEC - SBEC, UBEC
   * без BEC 

Няма да задълбавам повече. Винаги може [да питате чичо Гугъл](https://www.google.com/search?&q=electronic+speed+controller) и да се информирате допълнително. Както казах - темата е доооста просторна! И интересна! :)

### Какви контролери избрах аз?
Както, сигурно, сте прочели от снимките по-горе, аз се спрях на [DYS XS30A BLHeli](https://www.aliexpress.com/item/4pcs-lot-Original-DYS-XS30A-Blheli-30A-ESC-Electronic-Speed-Controller-3-6S-Support-Oneshot42-for/32776109383.html?spm=a2g0s.9042311.0.0.27424c4dLCixw6). Нямам никаква представа, защо точно тези. Бях гледал добро количество клипчета за правилен избор на ESC и марката DYS често попадаше сред тях. Ако четете последователно блога, ще забележите, че първо избрахме моторите. Ето защо избора на ESC-та за тях не е толкова сложен. При избора на мотор, в сайта на продавача, има спецификация на самия мотор и колко точно ток харчи той на пълна тяга. Имено това определи, какви контролери да взема. Ето пример:
> При мотор, който харчи на пълна тяга около 20 ампера ток (горе-долу като моите мотори), избрах да взема контролер, който поддържа 30А. Така си гарантирам, консумацията на мотора ДА НЕ ИЗГОРИ контролера му. Един 20А DYS BLHeli щеше също да свърши чудесна работа, но все пак реших на големия дрон да сложа малко "по-дебели" ESC-та.

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p10/esc0.jpg "Контролер на мотор DYS XS30A BLHeli 30A")

Една подсказка: по-малко ампери = по-малка цена! Ако цената ви определя - не се колебайте да рискувате!

### Програмиране на ESC

За програмист, като мен, това ми беше любимата част. Летателният контролер, на който се спряхме, допуска т.нар. "pass-through" или казано на български - програмирай ми контролера на мотора през летателния контролер. В началото се изкефих много - така или иначе закачам летателния контролер за подмяна на фърмуери, настройка на параметри и т.н., що пък да не си настроя и посоката на въртене на моторите оттам? ДА - можете да сменяте посоката на въртене на безчетковия ви мотор през контролера му за управление, СОФТУЕРНО! ДА, ама не! Pass-through-то не сработи за Pixhawk-a и решихме да потърсим алтернативи. Ники поръча веднага една от тези джиджавки:

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p10/esc2.jpg "USB програматор за контролери за безчеткови мотори")

[USB програматорчето](https://www.aliexpress.com/item/DYS-mini-USB-Linker-for-the-ESC-programmer-to-update-SimonK-and-BLHeli-firmware/32796212057.html?spm=2114.search0104.3.293.3f591affbSX8nz&ws_ab_test=searchweb0_0,searchweb201602_1_10065_10068_319_317_10696_10084_453_454_10083_10618_10304_10307_10820_10821_538_537_10302_536_10059_10884_10887_100031_321_322_10103,searchweb201603_51,ppcSwitch_0&algo_expid=8a572f0b-77d3-4568-b4c8-9edf44a33f86-43&algo_pvid=8a572f0b-77d3-4568-b4c8-9edf44a33f86) свърши чудесна работа на полеви условия вкъщи. С него, всеки един контролер се програмира поотделно, но предвид работата, която ти спестява - това си беше бонус! Ще питате, какво пък толкова спестява? Представете си, че сте навързали цялото окабеляване по един октакоптер (8-коптер) и сте запоили контролерите за моторите. Палите дрона и виждате, че половината мотори се въртят в правилна посока, а другата половина - не... АМИ СЕГА?! Ще разпоявате ли наново или ще закачите на едно USB и през една програмка ще смените един флаг и ще запишете настройката на контролера? Е - и аз избрах второто! :)

Мисля, че добре покрихме тази тема, затова слагам края тук. Подбирайте контролерите според вида на моторчето, което ще задвижват. Също важно изискване е да могат да са програмируеми - винаги стават фалове с грешен фърмуер, но ако се допуска флашване на фърмуера - просто ще си качим правилен. И пак да кажа - не винаги цената означава на сто процента качествен продукт. Пробвайте и намерете подходящия за вас контролер.

До скоро и усмивки! ;)