---
layout: post
title: "Да си направим дрон - еп. 1 - Летателен контролер"
author: "Димитър Димитров"
categories: play
tags: [play]
image: p6/fcHeader.jpg
---

Здравейте!

В поредния пост за сглабянето на дрона, ще ви покажа "сърцето" и "мозъка" му. Една от първите ми поръчки на чаркалаци за машината беше [този комплект](https://www.aliexpress.com/item/NEW-Pixhawk-PIX-2-4-8-32-Bit-PX4-Flight-Controller-433-Telemetry-M8N-GPS-Minim/32846924625.html?spm=a2g0s.9042311.0.0.77864c4dN5LNxa). Основното в него е т.нар. "летателен контролер" (flight controller) - Pixhawk PX4. Преди няколко дни видях, че е пристигнал в България и отскочих до митницата, за да си го освободя. Цялото удоволствие ми струваше +50 лева, но предвид, че пристигна за по-малко от месец, с кеф ги дадох. Дано другите неща, които чакам, се разминат с пустата митница, че току виж изплатя още едни дрон с данъците и таксите. И така... няколко думи за комплекта, но нека първо ви го покажа:

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p6/fcSet0.jpg "Pixhawk PX4 - комплект за хоби проекти (въздушни)")

### Pixhawk PX4
Най-важната част от комплекта е контролерът Pixhawk PX4. Той е логичното продължение на дългогодишен проект с отворен код, който събира любителите на хоби занаяти, свързани с управление на разни детски и не толкова детски джаджи. Проектът се казва [ArduPilot](http://ardupilot.org/), а Pixhawk е въпросният контролер. Контролер, най-общо казано, означава, че той се грижи за връзката и управлението на цялата необходима периферия (двигатели, управление на двигателите, телеметрия, GPS и др.) за даден хоби проект. Сам по себе си, контролерът е микропроцесорна система, с инсталиран на нея специализиран фърмуер (firmware), който в зависимост от вида на пилотираната машина, е различен. Ето и малко по-подробна информация за моят контролер:

#### Микропроцесор
* 32-битов, 2 MB флаш памет STM32F427 Cortex M4, с работна честота от 168 MHz и 256K RAM памет
* 32-битов STM32F103 резервен ко-процесор

#### Сензори
* L3GD20 3-осен цифров жироскоп
* LSM303D 3-осен акселерометър / магнитометър
* MPU6000 6-осен акселерометър / магнитометър
* MS5611 прецизен барометър

#### Интерфейси за връзка с периферия
* UART
* CAN
* DSM / DSM2 / DSM-X входове за GPS
* SBUS
* PPM
* RSSI (PWM или волтов) вход
* I2C
* SPI
* 3.3 волта и 6.6 волта вход
* Външен Micro USB

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p6/fcPixhawk.jpg "Pixhawk PX4")

[Инсталацията на фърмуера](http://ardupilot.org/planner/docs/common-loading-firmware-onto-pixhawk.html) е много лесна задачка, дори за начинаещи в хобито. Разбира се, необходими са базови компютърни умения. Накратко - необходим ви е специализиран БЕЗПЛАТЕН софтуер и малко свободно време за проба:
* [Mission Planner](http://ardupilot.org/planner/docs/mission-planner-overview.html) - наземен контрол и фърмуер инсталация за Windows
* [APM Planner 2.0](http://ardupilot.org/planner2/) - наземен контрол и фърмуер инсталация за Windows, Mac OS и Linux

И двата софтуера са що-годе идентични, поне на пръв поглед. Аз мисля да ползвам APM Planner 2.0, защото ще съм с Linux машина "на полето". След време ще добавя специален пост за софтуера, веднага щом го разуча достатъчно добре.

### Телеметрия
Ако не знаете какво е телеметрия, то време е да научите! Телеметрията представлява метод за дистанционно предаване на информация от сензори, които се намират на борда на пилотираната машина (дрон, самолет, джип, лодка и т.н.) към пилота. Най-често данните се предават в цифров вид чрез радио сигнал. За целта, на борда на дрона поставяме предавател, който си "говори" на определена честота с наземен приемник. От своя страна, приемникът се свързва с подходящо визуализиращо устройство (лаптоп, таблет, телефон и др.) и показва данните от сензорите на дрона. Най-важният показател, който искаме винаги да знаем в какво състояние е - това е батерията на дрона. Все пак като си сглабяме дрон, който ще тежи около 3 килограма и ще искаме да лети на 500-1000 метра височина, е хубаво да знаем, кога батерията свършва, за да го приземим без инциденти. Телеметрията се грижи за предаването на показателите на батерията, бордната камера (предава видео сигнал от дрона при наличие на камера) и всякакви видове полезни сензори (GPS, посока на вятър, температура и т.н.). В зависимост от избора на телеметрия, може да варираме в обхвата на предаване на данните, но в най-общия случай - всички работят сравнително ефективно. Основното в предаването на радио сигналите са хубавите антени.

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p6/fcTelemetry.jpg "3D Robotics комплект за телеметрия")

### GPS
Системата за глобално позициониране (GPS) се използва за правилното ориентиране на дрона в пространството. Благодарение на нея, дронът седи стабилен, независимо от атмосферните условия. Ако духа вятър и дронът се измества леко от позицията си, GPS-a помага за компенсиране на вятъра и запазване на точно определената от пилота позиция. В зависимост от прецизността на модула, точността на запазване на позицията варира, но дори сравнително евтините GPS модули са далеч по-прецизни от мобилен телефон.

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p6/fcGPS.jpg "Ublox M8N GPS модул")

### OSD (On-Screen Display)
Mini OSD модулът помага за удобното показване на данните от телеметрията на екрана на наземния контрол. При наличие на камера на борда на дрона, пилотът може да следи данните за батерията и останалите сензори, директно върху екрана на камерата. Това е доста удобна джаджа при контрол на дрона на далечно разстояние, защото именно камерата е основното, което пилотът следи.

![<<не е намерено изображение>>]({{ site.github.url }}/assets/img/p6/fcOSD.jpg "Mini OSD")

Това бяха по-важните неща от този базов комплект. Остават няколко вида конектори, програматор, транслатор на сигнала от дистанционното управление и още куп дреболии - стойка за летателен контролер, винтчета, кабелчета, адаптер за micro SD карта и др. Бях малко разочарован, защото летателният контролер не потегля без micro SD карта (която липсва в комплекта), затова си пригответе една от резервните ви. Контролера я ползва за "черна кутия" и записва в нея логове с данни за полетите ви. Полезна фукнция... вече не съм толкова разочарован!

Надявам се скоро да пробвате и вие. Както виждате - всичко това, както го започваме на игра, така е изпълнено с много нови и полезни знания. Започваме да отчитаме и пресмятаме какво е необходимо за един приятен и забавен полет, който да запечатаме с правилната камера. Смея да кажа, че пилотирането на дрон хич не е лесна задачка, но свикнете ли - няма отърване. А колкото до дрона, който ще сглобя скоро - неговото управление е още по-подходящо да се научите. Всички тези джаджи по-горе ще ви помагат за по-лесен контрол и ще разкриват потенциала на летенето. Аз лично реших така да се науча, затова и го правя от началото - за да знам от какво е направена една летяща машина. В следващия епизод ще ви покажа рамката за дрона, която всеки момент трябва да кацне в България.

Поздрави и до скоро!